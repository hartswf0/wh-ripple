<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Repository Grid + Ripples ‚Äî hartswf0</title>
  <style>
    :root{
      --bg:#0a0a0a;
      --text:#f5f3ef;
      --accent:#ff6b35;
      --muted:#888;
      --panel:#1a1a1a;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow:hidden}
    body{
      background:radial-gradient(ellipse at center, #1a1a1a 0%, #0a0a0a 100%);
      color:var(--text);
      font:14px/1.5 -apple-system, sans-serif;
    }

    /* Header */
    header{
      position:fixed;
      top:0;
      left:0;
      right:0;
      z-index:100;
      background:rgba(10,10,10,0.98);
      backdrop-filter:blur(20px);
      border-bottom:1px solid rgba(255,107,53,0.2);
      padding:12px 20px;
    }

    .header-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:6px 0;
      min-height:24px;
    }

    .header-user{
      font-size:11px;
      color:var(--text);
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:400;
      letter-spacing:0.3px;
      line-height:16px;
      flex-wrap:nowrap;
      white-space:nowrap;
    }

    .header-user strong{
      color:var(--accent);
      font-weight:600;
    }

    .header-name{
      color:var(--text);
      font-weight:600;
      opacity:0.9;
    }

    /* Minimap - Full Width Touchpad */
    .minimap{
      position:relative;
      width:100%;
      background:rgba(0,0,0,0.6);
      padding:8px;
      border-top:1px solid rgba(255,107,53,0.2);
      border-bottom:1px solid rgba(255,107,53,0.2);
    }

    .minimap-container{
      position:relative;
      max-width:100%;
      margin:0 auto;
    }

    .minimap-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, 8px);
      gap:3px;
      justify-content:center;
      width:100%;
    }

    .minimap-dot{
      width:8px;
      height:8px;
      border-radius:2px;
      opacity:0.85;
      transition:all 0.15s ease;
      cursor:pointer;
    }

    .minimap-dot:hover{
      opacity:1;
      transform:scale(1.3);
      box-shadow:0 0 12px currentColor;
      z-index:10;
      position:relative;
    }

    .minimap-dot.active{
      opacity:1;
      transform:scale(1.4);
      box-shadow:0 0 16px currentColor, inset 0 0 8px rgba(255,255,255,0.5);
      border:2px solid rgba(255,255,255,0.9);
      z-index:10;
      position:relative;
    }

    .viewport-indicator{
      position:absolute;
      border:2px solid rgba(255,255,255,0.6);
      background:rgba(255,255,255,0.05);
      pointer-events:none;
      border-radius:2px;
      transition:all 0.2s ease;
      box-shadow:0 0 10px rgba(255,255,255,0.3);
    }

    .hamburger{
      display:none;
      width:24px;
      height:16px;
      border:none;
      background:transparent;
      cursor:pointer;
      flex-direction:column;
      align-items:flex-end;
      justify-content:space-between;
      padding:0;
      flex-shrink:0;
    }

    .hamburger span{
      width:24px;
      height:2px;
      background:var(--accent);
      transition:all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius:1px;
      display:block;
    }

    .hamburger.active span:nth-child(1){
      transform:rotate(45deg) translate(5px, 5px);
    }

    .hamburger.active span:nth-child(2){
      opacity:0;
    }

    .hamburger.active span:nth-child(3){
      transform:rotate(-45deg) translate(5px, -5px);
    }

    .header-grid{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    h1{
      font-size:18px;
      font-weight:600;
      letter-spacing:-0.5px;
      margin:0;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      font-size:12px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .control-section{
      display:flex;
      gap:8px;
      align-items:center;
    }

    /* Mobile menu */
    .mobile-menu{
      position:fixed;
      top:0;
      left:-220px;
      width:200px;
      height:100vh;
      background:rgba(10,10,10,0.98);
      backdrop-filter:blur(20px);
      border-right:1px solid var(--accent);
      padding:15px;
      transition:left 0.3s ease;
      z-index:200;
      overflow-y:auto;
    }

    .mobile-menu.open{
      left:0;
    }

    .mobile-menu-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:30px;
      padding-bottom:15px;
      border-bottom:1px solid rgba(255,107,53,0.2);
    }

    .mobile-menu-title{
      font-size:16px;
      font-weight:700;
      color:var(--accent);
    }

    .mobile-menu-close{
      background:none;
      border:none;
      color:var(--accent);
      font-size:24px;
      cursor:pointer;
      padding:0;
      line-height:1;
    }

    .mobile-menu-section{
      margin-bottom:25px;
    }

    .mobile-menu-label{
      font-size:9px;
      text-transform:uppercase;
      letter-spacing:0.5px;
      color:var(--muted);
      margin-bottom:10px;
      font-weight:700;
    }

    .mobile-menu .btn{
      width:100%;
      margin-bottom:10px;
      justify-content:center;
      padding:12px 8px;
      font-size:13px;
      font-weight:700;
      min-height:48px;
    }

    .mobile-menu select{
      width:100%;
      margin-bottom:10px;
      padding:10px 8px;
      font-size:12px;
      min-height:48px;
    }

    .theme-list{
      display:flex;
      flex-direction:column;
      gap:8px;
      max-height:400px;
      overflow-y:auto;
    }

    .theme-item{
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:6px;
      padding:10px;
      cursor:pointer;
      transition:all 0.2s;
    }

    .theme-item:hover, .theme-item.active{
      background:rgba(255,107,53,0.2);
      border-color:var(--accent);
    }

    .theme-item-header{
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:4px;
    }

    .theme-item-dot{
      width:10px;
      height:10px;
      border-radius:50%;
      flex-shrink:0;
    }

    .theme-item-name{
      font-size:12px;
      font-weight:600;
      flex:1;
    }

    .theme-item-count{
      font-size:11px;
      opacity:0.7;
    }

    .theme-item-desc{
      font-size:10px;
      opacity:0.6;
      margin-top:4px;
      line-height:1.3;
    }

    .menu-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.5);
      z-index:199;
      display:none;
    }

    .menu-overlay.open{
      display:block;
    }

    @media(max-width:768px){
      .hamburger{
        display:flex;
      }
      
      .header-grid{
        display:none;
      }
      
      #main{top:60px}
      .expanded{inset:60px 10px 10px}
    }

    @media(max-width:640px){
      h1{font-size:16px}
      .header-user{font-size:10px}
    }

    .btn{
      background:transparent;
      border:1px solid var(--accent);
      color:var(--accent);
      padding:6px 14px;
      border-radius:6px;
      cursor:pointer;
      font-size:12px;
      font-weight:600;
      transition:all 0.2s;
    }
    .btn:hover, .btn.active{
      background:var(--accent);
      color:#000;
    }

    .filter-group{
      display:flex;
      gap:8px;
      align-items:center;
      padding-left:15px;
      border-left:1px solid rgba(255,107,53,0.2);
    }

    select{
      background:rgba(255,107,53,0.1);
      border:1px solid rgba(255,107,53,0.3);
      color:var(--text);
      padding:6px 12px;
      border-radius:6px;
      font-size:12px;
      cursor:pointer;
    }

    .zoom-controls{
      display:flex;
      gap:5px;
    }

    .zoom-btn{
      width:30px;
      height:30px;
      padding:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
    }

    /* Main container */
    #main{
      position:absolute;
      top:70px;
      left:0;
      right:0;
      bottom:0;
      overflow:auto;
    }

    /* Canvas view (organic ripples) */
    #canvas-view{
      position:absolute;
      inset:0;
      display:none;
    }
    #canvas-view.active{display:block}

    canvas{
      width:100%;
      height:100%;
      cursor:grab;
    }
    canvas:active{cursor:grabbing}

    /* Grid view */
    #grid-view{
      display:none;
      padding:30px;
      max-width:1800px;
      margin:0 auto;
    }
    #grid-view.active{display:block}

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
      gap:20px;
      transition:all 0.3s ease;
    }

    .grid.zoom-sm{grid-template-columns:repeat(auto-fill, minmax(120px, 1fr));gap:12px}
    .grid.zoom-lg{grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:28px}
    .grid.zoom-xl{grid-template-columns:repeat(auto-fill, minmax(360px, 1fr));gap:35px}

    .orange{
      position:relative;
      aspect-ratio:1;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:transform 0.3s ease, opacity 0.3s ease;
      overflow:visible;
      opacity:0;
      transform:scale(0.8);
      animation:popIn 0.5s ease forwards;
      touch-action:manipulation;
      -webkit-user-select:none;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
    }

    @keyframes popIn{
      to{
        opacity:1;
        transform:scale(1);
      }
    }

    .orange:hover{
      transform:scale(1.1);
      z-index:10;
    }

    .orange:hover .hover-preview,
    .orange.show-preview .hover-preview{
      opacity:1;
      transform:scale(1);
    }

    .orange:hover .orange-content,
    .orange.show-preview .orange-content{
      opacity:0;
    }

    .orange-number{
      position:absolute;
      top:12px;
      right:12px;
      background:rgba(255,255,255,0.1);
      backdrop-filter:blur(10px);
      color:#000;
      min-width:50px;
      width:50px;
      height:32px;
      padding:0;
      border-radius:16px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:15px;
      font-weight:700;
      font-family:'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', ui-monospace, monospace;
      letter-spacing:-1px;
      z-index:1000;
      border:1px solid rgba(0,0,0,0.2);
      box-shadow:0 2px 8px rgba(0,0,0,0.2);
      transition:all 0.2s ease;
      pointer-events:auto;
      cursor:pointer;
      touch-action:manipulation;
      -webkit-user-select:none;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
    }

    .orange:hover .orange-number{
      background:var(--accent);
      color:#000;
      box-shadow:0 4px 12px rgba(255,107,53,0.5);
    }

    .orange.selected .orange-number{
      background:#fff;
      color:#000;
      box-shadow:0 4px 16px rgba(255,255,255,0.4);
    }

    /* Larger screens need even bigger numbers */
    @media(min-width:1200px){
      .orange-number{
        top:15px;
        right:15px;
        min-width:60px;
        width:60px;
        height:38px;
        font-size:17px;
      }
    }

    @media(min-width:1600px){
      .orange-number{
        top:18px;
        right:18px;
        min-width:66px;
        width:66px;
        height:42px;
        font-size:19px;
      }
    }

    .hover-preview{
      position:absolute;
      inset:5%;
      border-radius:50%;
      overflow:hidden;
      opacity:0;
      transform:scale(0.8);
      transition:all 0.3s ease;
      z-index:2;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .hover-preview iframe{
      width:200%;
      height:200%;
      border:none;
      transform:scale(0.5);
      transform-origin:center;
    }

    .connection-lines{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:1;
    }

    .orange-content{
      text-align:center;
      padding:20px;
      position:relative;
      z-index:2;
    }

    .orange-name{
      font-size:12px;
      font-weight:600;
      margin-bottom:4px;
      overflow:hidden;
      text-overflow:ellipsis;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }

    .orange-meta{
      font-size:10px;
      color:rgba(255,255,255,0.7);
    }

    /* Expanded view */
    .expanded{
      position:fixed;
      inset:80px 20px 20px;
      background:rgba(26,26,26,0.98);
      backdrop-filter:blur(20px);
      border:1px solid rgba(255,107,53,0.3);
      border-radius:12px;
      z-index:200;
      display:none;
      overflow:hidden;
    }
    .expanded.open{display:flex}

    .expanded-sidebar{
      width:280px;
      border-right:1px solid rgba(255,107,53,0.2);
      padding:25px;
      overflow-y:auto;
    }

    .expanded-main{
      flex:1;
      display:flex;
      flex-direction:column;
    }

    .expanded-header{
      padding:20px 25px;
      border-bottom:1px solid rgba(255,107,53,0.2);
      display:flex;
      justify-content:space-between;
      align-items:start;
    }

    .expanded-title{
      font-size:20px;
      font-weight:600;
      color:var(--accent);
      margin-bottom:10px;
    }

    .expanded-content{
      flex:1;
      overflow:auto;
      padding:25px;
    }

    .close-expanded{
      background:none;
      border:none;
      color:var(--muted);
      font-size:28px;
      cursor:pointer;
      line-height:1;
      padding:0;
    }
    .close-expanded:hover{color:var(--accent)}

    /* File ripples */
    .file-ripples{
      margin-top:20px;
    }

    .file-ripple-title{
      font-size:11px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:1px;
      color:var(--muted);
      margin-bottom:15px;
    }

    .file-ripple{
      display:inline-block;
      margin:5px;
      padding:8px 14px;
      background:rgba(255,107,53,0.1);
      border:1px solid rgba(255,107,53,0.3);
      border-radius:20px;
      font-size:11px;
      cursor:pointer;
      transition:all 0.2s;
    }
    .file-ripple:hover{
      background:rgba(255,107,53,0.3);
      transform:scale(1.05);
    }

    /* Iframe preview */
    .iframe-preview{
      width:100%;
      height:600px;
      border:1px solid rgba(255,107,53,0.2);
      border-radius:8px;
      background:#fff;
    }

    .preview-actions{
      margin-top:15px;
      display:flex;
      gap:10px;
    }

    .action-btn{
      padding:8px 16px;
      background:var(--accent);
      color:#000;
      text-decoration:none;
      border-radius:6px;
      font-weight:600;
      font-size:12px;
      border:none;
      cursor:pointer;
      transition:transform 0.2s;
    }
    .action-btn:hover{transform:translateY(-2px)}
    .action-btn.secondary{
      background:transparent;
      border:1px solid var(--accent);
      color:var(--accent);
    }

    /* Stats */
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(2, 1fr);
      gap:15px;
      margin-bottom:20px;
    }

    .stat-card{
      background:rgba(255,107,53,0.1);
      padding:12px;
      border-radius:8px;
      border:1px solid rgba(255,107,53,0.2);
    }

    .stat-label{
      font-size:10px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:0.5px;
    }

    .stat-value{
      font-size:18px;
      font-weight:700;
      color:var(--accent);
      margin-top:4px;
    }

    /* Legend */
    .legend{
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      background:rgba(10,10,10,0.95);
      backdrop-filter:blur(20px);
      border:2px solid var(--accent);
      border-radius:12px;
      padding:30px;
      z-index:400;
      opacity:0;
      animation:fadeInLegend 0.5s ease forwards 1s;
      max-width:400px;
    }

    @keyframes fadeInLegend{
      to{opacity:1}
    }

    .legend.hidden{display:none}

    .legend-title{
      font-size:20px;
      font-weight:700;
      color:var(--accent);
      margin-bottom:20px;
      text-align:center;
    }

    .legend-items{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .legend-item{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .legend-dot{
      width:12px;
      height:12px;
      border-radius:50%;
      flex-shrink:0;
    }

    .legend-label{
      font-size:13px;
      flex:1;
    }

    .legend-close{
      margin-top:20px;
      width:100%;
      padding:10px;
      background:var(--accent);
      color:#000;
      border:none;
      border-radius:6px;
      font-weight:700;
      cursor:pointer;
    }

    #loading{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--bg);
      z-index:300;
    }

    #loading.hidden{display:none}

    .spinner{
      width:50px;
      height:50px;
      border:3px solid rgba(255,107,53,0.2);
      border-top-color:var(--accent);
      border-radius:50%;
      animation:spin 0.8s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:transparent}
    ::-webkit-scrollbar-thumb{background:rgba(255,107,53,0.3);border-radius:4px}

    /* Timeline view */
    #timeline-view{
      display:none;
      padding:30px 20px;
      max-width:1400px;
      margin:0 auto;
    }
    #timeline-view.active{display:block}

    .timeline-header{
      text-align:center;
      margin-bottom:40px;
    }

    .timeline-title{
      font-size:24px;
      font-weight:700;
      color:var(--accent);
      margin-bottom:10px;
    }

    .timeline-range{
      color:var(--muted);
      font-size:14px;
    }

    .timeline{
      position:relative;
      padding:20px 0;
    }

    .timeline-line{
      position:absolute;
      left:50%;
      top:0;
      bottom:0;
      width:2px;
      background:linear-gradient(to bottom, var(--accent), var(--muted));
    }

    .timeline-year{
      margin:60px 0;
      position:relative;
    }

    .year-label{
      text-align:center;
      font-size:32px;
      font-weight:900;
      color:var(--accent);
      margin-bottom:20px;
      text-shadow:0 0 20px rgba(255,107,53,0.5);
    }

    .timeline-month{
      position:relative;
      margin:40px 0;
    }

    .month-label{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      background:var(--bg);
      padding:8px 16px;
      border-radius:20px;
      border:2px solid var(--accent);
      font-weight:600;
      font-size:14px;
      z-index:2;
    }

    .timeline-repos{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:20px;
      margin-top:50px;
    }

    .timeline-repo{
      position:relative;
      padding:20px;
      background:rgba(26,26,26,0.8);
      border:1px solid rgba(255,107,53,0.3);
      border-radius:12px;
      cursor:pointer;
      transition:all 0.3s;
    }

    .timeline-repo:nth-child(odd){
      justify-self:end;
      text-align:right;
    }

    .timeline-repo:nth-child(even){
      justify-self:start;
    }

    .timeline-repo:hover{
      transform:scale(1.05);
      border-color:var(--accent);
      box-shadow:0 4px 20px rgba(255,107,53,0.3);
    }

    .timeline-repo-name{
      font-weight:700;
      font-size:16px;
      margin-bottom:8px;
    }

    .timeline-repo-date{
      font-size:11px;
      color:var(--muted);
      margin-bottom:8px;
    }

    .timeline-repo-meta{
      display:flex;
      gap:10px;
      font-size:11px;
      color:var(--muted);
      margin-top:10px;
    }

    .timeline-repo:nth-child(odd) .timeline-repo-meta{
      justify-content:flex-end;
    }

    .timeline-dot{
      position:absolute;
      top:50%;
      width:16px;
      height:16px;
      background:var(--accent);
      border:3px solid var(--bg);
      border-radius:50%;
      z-index:3;
    }

    .timeline-repo:nth-child(odd) .timeline-dot{
      right:-58px;
    }

    .timeline-repo:nth-child(even) .timeline-dot{
      left:-58px;
    }

    @media(max-width:1024px){
      .timeline-repos{
        grid-template-columns:1fr;
        gap:30px;
      }
      
      .timeline-repo:nth-child(odd),
      .timeline-repo:nth-child(even){
        justify-self:stretch;
        text-align:left;
        margin-left:40px;
      }
      
      .timeline-repo .timeline-dot{
        left:-28px !important;
        right:auto !important;
      }
      
      .timeline-repo-meta{
        justify-content:flex-start !important;
      }
      
      .timeline-line{
        left:0;
      }
    }

    @media(max-width:768px){
      .expanded{inset:80px 10px 10px}
      .expanded-sidebar{display:none}
      .grid{grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));gap:15px}
    }

    @media(max-width:768px){
      #main{top:120px}
      header{padding:10px 15px}
      .expanded{inset:120px 10px 10px}
      .expanded-sidebar{display:none}
      .grid{grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));gap:15px}
      .timeline-view{padding:20px 10px}
      .year-label{font-size:24px}
      .timeline-repo{padding:15px;font-size:13px}
    }

    @media(max-width:480px){
      .grid{grid-template-columns:repeat(auto-fill, minmax(120px, 1fr));gap:12px}
      .orange-content{padding:12px}
      .orange-name{font-size:11px}
      .orange-meta{font-size:9px}
      .orange-number{
        min-width:40px;
        width:40px;
        height:26px;
        font-size:12px;
        top:8px;
        right:8px;
      }
    }

    /* Mobile: tap number to preview */
    @media (max-width: 768px){
      .orange.show-preview{
        transform:scale(1.05);
        z-index:50;
      }
      
      .orange-number::after{
        content:'üëÅ';
        position:absolute;
        bottom:-4px;
        right:-4px;
        font-size:12px;
        animation:pulse 2s ease-in-out infinite;
      }
      
      .orange.show-preview .orange-number::after{
        content:'‚úì';
        animation:none;
      }
    }
    
    @keyframes pulse{
      0%, 100%{ opacity:0.5; transform:scale(1); }
      50%{ opacity:1; transform:scale(1.2); }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-top">
      <div class="header-user">
        <a href="index.html" style="color:var(--accent);text-decoration:none;font-weight:600;opacity:0.8;margin-right:12px;" title="Home">üè∫</a>
        <span class="header-name">Watson Hartsoe</span>
        <span style="opacity:0.4">‚Ä¢</span>
        <span style="font-weight:500;opacity:0.8">@hartswf0</span>
        <span style="opacity:0.4">‚Ä¢</span>
        <span><strong id="count">245</strong> repos</span>
      </div>
      <button class="hamburger" id="hamburger" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    
    <div class="header-grid">
      <h1>Repository Explorer</h1>
      <div class="controls">
        <div class="control-section">
          <button class="btn active" id="view-grid">Grid</button>
          <button class="btn" id="view-ripple">Ripples</button>
          <button class="btn" id="view-timeline">Timeline</button>
        </div>
        
        <div class="filter-group">
          <select id="filter-theme">
            <option value="all">All Themes</option>
          </select>
          
          <select id="filter-lang">
            <option value="all">All Languages</option>
          </select>
          
          <select id="sort-by">
            <option value="theme">By Theme</option>
            <option value="created">Chronological (Newest)</option>
            <option value="oldest">Chronological (Oldest)</option>
            <option value="stars">By Stars</option>
            <option value="size">By Size</option>
            <option value="updated">Recently Updated</option>
            <option value="name">By Name</option>
          </select>
        </div>
        
        <div class="control-section">
          <div class="zoom-controls">
            <button class="btn zoom-btn" id="zoom-out">‚àí</button>
            <button class="btn zoom-btn" id="zoom-in">+</button>
          </div>
          
          <button class="btn" id="show-connections">Connections</button>
        </div>
      </div>
    </div>
    
    <!-- Minimap Touchpad -->
    <div class="minimap" id="minimap">
      <div class="minimap-container">
        <div class="minimap-grid" id="minimap-grid"></div>
        <div class="viewport-indicator" id="viewport-indicator"></div>
      </div>
    </div>
  </header>

  <!-- Mobile Menu -->
  <div class="menu-overlay" id="menu-overlay"></div>
  <div class="mobile-menu" id="mobile-menu">
    <div class="mobile-menu-header">
      <div class="mobile-menu-title">Menu</div>
      <button class="mobile-menu-close" id="menu-close">&times;</button>
    </div>
    
    <div class="mobile-menu-section">
      <div class="mobile-menu-label">Views</div>
      <button class="btn active" id="mobile-view-grid">Grid</button>
      <button class="btn" id="mobile-view-ripple">Ripples</button>
      <button class="btn" id="mobile-view-timeline">Timeline</button>
    </div>
    
    <div class="mobile-menu-section">
      <div class="mobile-menu-label">Themes</div>
      <div id="mobile-theme-list" class="theme-list"></div>
    </div>
    
    <div class="mobile-menu-section">
      <div class="mobile-menu-label">Language</div>
      <select id="mobile-filter-lang">
        <option value="all">All Languages</option>
      </select>
    </div>
    
    <div class="mobile-menu-section">
      <div class="mobile-menu-label">Sort</div>
      <select id="mobile-sort-by">
        <option value="theme">By Theme</option>
        <option value="created">Newest First</option>
        <option value="oldest">Oldest First</option>
        <option value="stars">By Stars</option>
        <option value="size">By Size</option>
        <option value="updated">Recently Updated</option>
        <option value="name">By Name</option>
      </select>
    </div>
    
    <div class="mobile-menu-section">
      <div class="mobile-menu-label">Zoom</div>
      <button class="btn zoom-btn" id="mobile-zoom-out">‚àí Zoom Out</button>
      <button class="btn zoom-btn" id="mobile-zoom-in">+ Zoom In</button>
    </div>
    
    <div class="mobile-menu-section">
      <button class="btn" id="mobile-connections">Connections</button>
    </div>
  </div>

  <div id="main">
    <!-- Grid View -->
    <div id="grid-view" class="active">
      <div class="grid" id="grid-container"></div>
    </div>

    <!-- Canvas View -->
    <div id="canvas-view">
      <canvas id="canvas"></canvas>
    </div>

    <!-- Timeline View -->
    <div id="timeline-view">
      <div class="timeline-header">
        <h2 class="timeline-title">Repository Timeline</h2>
        <div class="timeline-range" id="timeline-range"></div>
      </div>
      <div class="timeline" id="timeline-container"></div>
    </div>
  </div>

  <!-- Expanded Repo View -->
  <div class="expanded" id="expanded">
    <div class="expanded-sidebar">
      <div class="stats-grid" id="stats"></div>
      <div class="file-ripples">
        <div class="file-ripple-title">Related Content</div>
        <div id="file-list"></div>
      </div>
    </div>
    <div class="expanded-main">
      <div class="expanded-header">
        <div>
          <h2 class="expanded-title" id="exp-title"></h2>
          <div style="color:var(--muted);font-size:13px" id="exp-desc"></div>
        </div>
        <button class="close-expanded" id="close-expanded">&times;</button>
      </div>
      <div class="expanded-content" id="exp-content"></div>
    </div>
  </div>

  <div id="loading">
    <div class="spinner"></div>
  </div>

  <!-- Legend overlay -->
  <div class="legend" id="legend">
    <div class="legend-title">Repository Themes</div>
    <div class="legend-items" id="legend-items"></div>
    <button class="legend-close" id="legend-close">Got it!</button>
  </div>

  <script>
    // Audio removed - too annoying for browsing
    // Can be re-enabled per-file if needed
  </script>
  <script>
    let data = null;
    let canvas, ctx;
    let repos = [];
    let ripples = [];
    let currentView = 'grid';
    let zoomLevel = 'md'; // sm, md, lg, xl
    let currentFilter = {theme: 'all', lang: 'all', sort: 'theme'};
    let showConnections = false;
    let filteredRepos = [];
    let repoIndex = 0;

    // Ripple class (for canvas view)
    class Ripple{
      constructor(x, y, color){
        this.x = x;
        this.y = y;
        this.radius = 0;
        this.maxRadius = 100;
        this.color = color;
        this.opacity = 1;
        this.speed = 2;
      }
      
      update(){
        this.radius += this.speed;
        this.opacity = 1 - (this.radius / this.maxRadius);
        return this.radius < this.maxRadius;
      }
      
      draw(ctx){
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.strokeStyle = this.color + Math.floor(this.opacity * 255).toString(16).padStart(2, '0');
        ctx.lineWidth = 3;
        ctx.stroke();
      }
    }

    // Repo class (for canvas view)
    class Repo{
      constructor(data, x, y, radius, color, number){
        this.data = data;
        this.x = x;
        this.y = y;
        this.targetX = x;
        this.targetY = y;
        this.radius = radius;
        this.baseRadius = radius;
        this.color = color;
        this.pulse = 0;
        this.hovered = false;
        this.number = number;
      }
      
      update(){
        this.x += (this.targetX - this.x) * 0.1;
        this.y += (this.targetY - this.y) * 0.1;
        this.pulse += 0.05;
        this.radius = this.baseRadius + Math.sin(this.pulse) * (this.hovered ? 3 : 1);
      }
      
      draw(ctx){
        ctx.save();
        ctx.shadowColor = this.color;
        ctx.shadowBlur = this.hovered ? 20 : 10;
        
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        
        const grad = ctx.createRadialGradient(
          this.x - this.radius * 0.3, this.y - this.radius * 0.3, 0,
          this.x, this.y, this.radius
        );
        grad.addColorStop(0, this.color + 'ff');
        grad.addColorStop(0.7, this.color + 'cc');
        grad.addColorStop(1, this.color + '88');
        
        ctx.fillStyle = grad;
        ctx.fill();
        
        // Highlight
        ctx.beginPath();
        ctx.arc(this.x - this.radius * 0.3, this.y - this.radius * 0.3, this.radius * 0.3, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fill();
        
        ctx.restore();
        
        // Draw number badge - standardized for 3 digits
        if(this.number){
          ctx.save();
          
          // Pill-shaped background
          const badgeWidth = 22;
          const badgeHeight = 14;
          const badgeX = this.x;
          const badgeY = this.y - this.radius * 0.6;
          
          ctx.beginPath();
          ctx.roundRect(badgeX - badgeWidth/2, badgeY - badgeHeight/2, badgeWidth, badgeHeight, badgeHeight/2);
          ctx.fillStyle = 'rgba(255,255,255,0.15)';
          ctx.fill();
          ctx.strokeStyle = 'rgba(0,0,0,0.3)';
          ctx.lineWidth = 1;
          ctx.stroke();
          
          ctx.font = '700 11px "SF Mono", "Monaco", monospace';
          ctx.fillStyle = '#000';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.shadowColor = 'rgba(255,255,255,0.5)';
          ctx.shadowBlur = 2;
          ctx.fillText(this.number, badgeX, badgeY);
          ctx.restore();
        }
        
        if(this.hovered){
          ctx.font = '600 11px -apple-system, sans-serif';
          ctx.textAlign = 'center';
          ctx.fillStyle = '#fff';
          ctx.shadowColor = 'rgba(0,0,0,0.8)';
          ctx.shadowBlur = 4;
          const name = this.data.name.length > 20 ? this.data.name.substring(0, 18) + '...' : this.data.name;
          ctx.fillText(name, this.x, this.y + this.radius + 15);
        }
      }
      
      contains(x, y){
        const dx = x - this.x;
        const dy = y - this.y;
        return dx * dx + dy * dy <= this.radius * this.radius;
      }
    }

    function init(){
      canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');
      resize();
      window.addEventListener('resize', resize);
      setupEvents();
      loadData();
    }

    function resize(){
      if(canvas.offsetWidth && canvas.offsetHeight){
        canvas.width = canvas.offsetWidth * window.devicePixelRatio;
        canvas.height = canvas.offsetHeight * window.devicePixelRatio;
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
      }
    }

    async function loadData(){
      try{
        const response = await fetch('github-thematic-index.json');
        data = await response.json();
        document.getElementById('count').textContent = data.summary.total_repos;
        
        // Populate filter dropdowns
        populateFilters();
        
        // Create minimap
        createMinimap();
        
        // Create and show legend
        createLegend();
        
        // Create initial views
        applyFiltersAndSort();
        createCanvasRepos();
        document.getElementById('loading').classList.add('hidden');
        animate();
      }catch(err){
        console.error('Failed to load:', err);
        document.getElementById('loading').innerHTML = 
          '<div style="color:#888">Failed to load<br><small>Run: python3 analyze-themes.py</small></div>';
      }
    }

    // Theme descriptions
    const themeDescriptions = {
      'media-theory': 'McLuhan, media ecology, and communication theory projects',
      'ai-ml': 'Artificial intelligence, machine learning, and neural networks',
      'web-dev': 'Web development, frameworks, and frontend technologies',
      'interactive': 'Interactive experiences, visualizations, and UI experiments',
      'data-viz': 'Data visualization, charts, and information graphics',
      'education': 'Educational tools, learning platforms, and teaching resources',
      'creative': 'Creative coding, generative art, and experimental projects',
      'tools': 'Development tools, utilities, and productivity apps',
      'audio': 'Sound, music, and audio processing projects',
      'narrative': 'Storytelling, narrative experiences, and interactive fiction',
      '3d': '3D visualization, WebGL, and spatial computing',
      'philosophy': "Philosophy, Plato's works, and theoretical frameworks",
      'archives': 'Archives, collections, and historical documentation',
      'time': 'Time-based projects, memory, and temporal experiences',
      'systems': 'System design, agents, and complex interactions',
      'other': 'Diverse projects awaiting thematic categorization'
    };

    function populateFilters(){
      const themeSelect = document.getElementById('filter-theme');
      const langSelect = document.getElementById('filter-lang');
      const mobileThemeList = document.getElementById('mobile-theme-list');
      const mobileLangSelect = document.getElementById('mobile-filter-lang');
      
      // Populate desktop theme select
      data.theme_rings.forEach(theme => {
        const option = document.createElement('option');
        option.value = theme.theme_id;
        option.textContent = `${theme.theme_name} (${theme.repo_count})`;
        themeSelect.appendChild(option);
      });
      
      // Populate mobile theme list with descriptions
      const allThemes = document.createElement('div');
      allThemes.className = 'theme-item active';
      allThemes.dataset.themeId = 'all';
      allThemes.innerHTML = `
        <div class="theme-item-header">
          <div class="theme-item-name">All Themes</div>
          <div class="theme-item-count">${data.summary.total_repos}</div>
        </div>
        <div class="theme-item-desc">Show all repositories across every theme</div>
      `;
      allThemes.addEventListener('click', () => {
        document.querySelectorAll('.theme-item').forEach(t => t.classList.remove('active'));
        allThemes.classList.add('active');
        currentFilter.theme = 'all';
        applyFiltersAndSort();
      });
      mobileThemeList.appendChild(allThemes);
      
      data.theme_rings.forEach(theme => {
        const item = document.createElement('div');
        item.className = 'theme-item';
        item.dataset.themeId = theme.theme_id;
        const desc = themeDescriptions[theme.theme_id] || theme.theme_name;
        item.innerHTML = `
          <div class="theme-item-header">
            <div class="theme-item-dot" style="background:${theme.color}"></div>
            <div class="theme-item-name">${theme.theme_name}</div>
            <div class="theme-item-count">${theme.repo_count}</div>
          </div>
          <div class="theme-item-desc">${desc}</div>
        `;
        item.addEventListener('click', () => {
          document.querySelectorAll('.theme-item').forEach(t => t.classList.remove('active'));
          item.classList.add('active');
          currentFilter.theme = theme.theme_id;
          applyFiltersAndSort();
        });
        mobileThemeList.appendChild(item);
      });
      
      // Populate desktop and mobile language filters
      const languages = new Set();
      
      data.theme_rings.forEach(theme => {
        theme.repos.forEach(repo => {
          if(repo.language) languages.add(repo.language);
        });
      });
      
      Array.from(languages).sort().forEach(lang => {
        const option = document.createElement('option');
        option.value = lang;
        option.textContent = lang;
        langSelect.appendChild(option.cloneNode(true));
        mobileLangSelect.appendChild(option);
      });
    }

    function applyFiltersAndSort(){
      // Flatten all repos
      let allRepos = [];
      data.theme_rings.forEach(theme => {
        theme.repos.forEach(repo => {
          allRepos.push({...repo, theme: theme, themeColor: theme.color});
        });
      });
      
      // Apply filters
      filteredRepos = allRepos.filter(repo => {
        if(currentFilter.theme !== 'all' && repo.theme.theme_id !== currentFilter.theme) return false;
        if(currentFilter.lang !== 'all' && repo.language !== currentFilter.lang) return false;
        return true;
      });
      
      // Apply sorting
      switch(currentFilter.sort){
        case 'created':
          filteredRepos.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
          break;
        case 'oldest':
          filteredRepos.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
          break;
        case 'stars':
          filteredRepos.sort((a, b) => b.stars - a.stars);
          break;
        case 'size':
          filteredRepos.sort((a, b) => b.size_kb - a.size_kb);
          break;
        case 'updated':
          filteredRepos.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
          break;
        case 'name':
          filteredRepos.sort((a, b) => a.name.localeCompare(b.name));
          break;
        case 'theme':
        default:
          // Already grouped by theme
          break;
      }
      
      document.getElementById('count').textContent = filteredRepos.length;
      createGridView();
      if(currentView === 'timeline'){
        createTimelineView();
      }
    }

    function createMinimap(){
      const container = document.getElementById('minimap-grid');
      container.innerHTML = '';
      
      // Get all repos with theme info
      window.allMinimapRepos = [];
      data.theme_rings.forEach(theme => {
        theme.repos.forEach(repo => {
          window.allMinimapRepos.push({...repo, theme: theme, themeColor: theme.color});
        });
      });
      
      // Create dots
      window.allMinimapRepos.forEach((repo, idx) => {
        const dot = document.createElement('div');
        dot.className = 'minimap-dot';
        dot.style.background = repo.themeColor;
        dot.style.color = repo.themeColor;
        dot.title = repo.name;
        dot.dataset.index = idx;
        
        // Click to jump to repo in grid
        dot.addEventListener('click', (e) => {
          e.stopPropagation();
          
          // Highlight this dot
          container.querySelectorAll('.minimap-dot').forEach(d => d.classList.remove('active'));
          dot.classList.add('active');
          
          // Switch to grid view if not already
          if(currentView !== 'grid'){
            document.getElementById('view-grid').click();
          }
          
          // Scroll to and open the repo
          setTimeout(() => {
            const oranges = document.querySelectorAll('.orange');
            if(oranges[idx]){
              // Scroll with offset so header doesn't cover it
              const orange = oranges[idx];
              const mainEl = document.getElementById('main');
              const orangeTop = orange.offsetTop;
              const headerHeight = 150; // Account for header + minimap
              mainEl.scrollTo({
                top: orangeTop - headerHeight - 50,
                behavior: 'smooth'
              });
              
              // Pulse animation
              orange.style.animation = 'none';
              setTimeout(() => {
                orange.style.animation = 'pulse 0.5s ease 3';
                // Auto-open the expanded view
                setTimeout(() => {
                  orange.click();
                }, 500);
              }, 10);
            }
          }, 100);
        });
        
        container.appendChild(dot);
      });
      
      // Setup viewport indicator
      setupViewportIndicator();
    }

    function createLegend(){
      const container = document.getElementById('legend-items');
      const legendEl = document.getElementById('legend');
      
      // Add top 6 themes
      const topThemes = data.theme_rings.slice(0, 6);
      
      topThemes.forEach(theme => {
        const item = document.createElement('div');
        item.className = 'legend-item';
        item.innerHTML = `
          <div class="legend-dot" style="background:${theme.color}"></div>
          <div class="legend-label">${theme.theme_name} (${theme.repo_count})</div>
        `;
        container.appendChild(item);
      });
      
      // Close button
      document.getElementById('legend-close').addEventListener('click', () => {
        legendEl.classList.add('hidden');
      });
      
      // Auto-hide after 8 seconds
      setTimeout(() => {
        legendEl.classList.add('hidden');
      }, 8000);
    }
    
    function setupViewportIndicator(){
      const mainEl = document.getElementById('main');
      const indicator = document.getElementById('viewport-indicator');
      const minimapGrid = document.getElementById('minimap-grid');
      
      function updateViewportIndicator(){
        if(currentView !== 'grid') {
          indicator.style.display = 'none';
          return;
        }
        
        indicator.style.display = 'block';
        
        const oranges = document.querySelectorAll('.orange');
        if(!oranges.length) return;
        
        // Calculate which oranges are visible
        const scrollTop = mainEl.scrollTop;
        const viewportHeight = mainEl.clientHeight;
        const scrollBottom = scrollTop + viewportHeight;
        
        let firstVisible = -1;
        let lastVisible = -1;
        
        oranges.forEach((orange, idx) => {
          const rect = orange.getBoundingClientRect();
          const orangeTop = orange.offsetTop;
          const orangeBottom = orangeTop + orange.offsetHeight;
          
          if(orangeBottom >= scrollTop && orangeTop <= scrollBottom){
            if(firstVisible === -1) firstVisible = idx;
            lastVisible = idx;
          }
        });
        
        if(firstVisible === -1) return;
        
        // Get minimap dots positions
        const dots = minimapGrid.querySelectorAll('.minimap-dot');
        if(!dots.length) return;
        
        const firstDot = dots[firstVisible];
        const lastDot = dots[lastVisible];
        
        if(!firstDot || !lastDot) return;
        
        // Get all visible dots to find bounding box
        const visibleDots = Array.from(dots).slice(firstVisible, lastVisible + 1);
        const gridRect = minimapGrid.getBoundingClientRect();
        
        // Find min/max coordinates across all visible dots
        let minLeft = Infinity, minTop = Infinity;
        let maxRight = -Infinity, maxBottom = -Infinity;
        
        visibleDots.forEach(dot => {
          const rect = dot.getBoundingClientRect();
          minLeft = Math.min(minLeft, rect.left);
          minTop = Math.min(minTop, rect.top);
          maxRight = Math.max(maxRight, rect.right);
          maxBottom = Math.max(maxBottom, rect.bottom);
        });
        
        // Position relative to grid
        const left = minLeft - gridRect.left - 2;
        const top = minTop - gridRect.top - 2;
        const width = maxRight - minLeft + 4;
        const height = maxBottom - minTop + 4;
        
        indicator.style.left = `${left}px`;
        indicator.style.top = `${top}px`;
        indicator.style.width = `${width}px`;
        indicator.style.height = `${height}px`;
      }
      
      // Update on scroll
      mainEl.addEventListener('scroll', updateViewportIndicator);
      
      // Update on resize
      window.addEventListener('resize', updateViewportIndicator);
      
      // Initial update
      setTimeout(updateViewportIndicator, 500);
    }
    
    // Add pulse animation for highlighting
    const style = document.createElement('style');
    style.textContent = `
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.15); box-shadow: 0 0 20px currentColor; }
      }
    `;
    document.head.appendChild(style);

    function createGridView(){
      const grid = document.getElementById('grid-container');
      grid.innerHTML = '';
      
      // Apply zoom class
      grid.className = 'grid';
      if(zoomLevel !== 'md') grid.classList.add(`zoom-${zoomLevel}`);
      
      repoIndex = 0;
      filteredRepos.forEach((repo, idx) => {
        repoIndex++;
        const orange = document.createElement('div');
        orange.className = 'orange';
        orange.style.background = `radial-gradient(circle at 30% 30%, ${repo.themeColor}ff, ${repo.themeColor}cc 70%, ${repo.themeColor}88)`;
        orange.style.boxShadow = `0 4px 15px ${repo.themeColor}80, inset -10px -10px 20px rgba(0,0,0,0.3), inset 10px 10px 20px rgba(255,255,255,0.2)`;
        
        // Stagger animation delay
        orange.style.animationDelay = `${idx * 0.02}s`;
        orange.dataset.repoIndex = idx;
        
        // Hover preview
        const hoverPreview = repo.has_pages ? `
          <div class="hover-preview">
            <iframe src="https://hartswf0.github.io/${repo.name}/" loading="lazy"></iframe>
          </div>
        ` : '';
        
        orange.innerHTML = `
          <div class="orange-number">${repoIndex}</div>
          ${hoverPreview}
          <div class="orange-content">
            <div class="orange-name">${repo.name}</div>
            <div class="orange-meta">${repo.language || 'Repository'}</div>
          </div>
        `;
        
        // Detect mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
        
        if(isMobile){
          const numberBadge = orange.querySelector('.orange-number');
          
          // Mobile: number badge toggles preview
          numberBadge.addEventListener('click', (e) => {
            e.stopPropagation();
            e.preventDefault();
            
            // Close all other previews
            document.querySelectorAll('.orange.show-preview').forEach(o => {
              if(o !== orange) o.classList.remove('show-preview');
            });
            
            // Toggle this preview
            orange.classList.toggle('show-preview');
          });
          
          // Mobile: clicking orange opens expanded view
          orange.addEventListener('click', () => {
            if(!orange.classList.contains('show-preview')){
              showExpanded(repo, repo.theme);
              // Highlight in minimap
              const dots = document.querySelectorAll('.minimap-dot');
              dots.forEach(d => d.classList.remove('active'));
              if(dots[idx]) dots[idx].classList.add('active');
            }
          });
        } else {
          // Desktop: clicking anywhere opens expanded view
          orange.addEventListener('click', () => {
            showExpanded(repo, repo.theme);
            // Highlight in minimap
            const dots = document.querySelectorAll('.minimap-dot');
            dots.forEach(d => d.classList.remove('active'));
            if(dots[idx]) dots[idx].classList.add('active');
          });
        }
        
        grid.appendChild(orange);
      });
      
      // Close preview when clicking outside on mobile
      const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
      if(isMobileDevice){
        // Remove existing listener if any
        document.removeEventListener('click', closePreviewsHandler);
        document.addEventListener('click', closePreviewsHandler);
      }
    }
    
    // Define handler outside so we can remove/add it
    function closePreviewsHandler(e){
      if(!e.target.closest('.orange')){
        document.querySelectorAll('.orange.show-preview').forEach(o => {
          o.classList.remove('show-preview');
        });
      }
    }

    function createTimelineView(){
      const container = document.getElementById('timeline-container');
      container.innerHTML = '<div class="timeline-line"></div>';
      
      // Group repos by year and month
      const byYearMonth = {};
      filteredRepos.forEach(repo => {
        const date = new Date(repo.created_at);
        const year = date.getFullYear();
        const month = date.getMonth();
        
        if(!byYearMonth[year]) byYearMonth[year] = {};
        if(!byYearMonth[year][month]) byYearMonth[year][month] = [];
        byYearMonth[year][month].push(repo);
      });
      
      // Get date range
      const dates = filteredRepos.map(r => new Date(r.created_at));
      const minDate = new Date(Math.min(...dates));
      const maxDate = new Date(Math.max(...dates));
      document.getElementById('timeline-range').textContent = 
        `${minDate.toLocaleDateString('en-US', {month: 'long', year: 'numeric'})} ‚Äî ${maxDate.toLocaleDateString('en-US', {month: 'long', year: 'numeric'})}`;
      
      // Sort years descending (most recent first)
      const years = Object.keys(byYearMonth).sort((a, b) => b - a);
      
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
      
      years.forEach(year => {
        const yearSection = document.createElement('div');
        yearSection.className = 'timeline-year';
        yearSection.innerHTML = `<div class="year-label">${year}</div>`;
        
        // Sort months descending
        const months = Object.keys(byYearMonth[year]).sort((a, b) => b - a);
        
        months.forEach(month => {
          const monthSection = document.createElement('div');
          monthSection.className = 'timeline-month';
          monthSection.innerHTML = `<div class="month-label">${monthNames[month]}</div>`;
          
          const reposContainer = document.createElement('div');
          reposContainer.className = 'timeline-repos';
          
          // Sort repos by date within month
          byYearMonth[year][month]
            .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
            .forEach(repo => {
              const repoEl = document.createElement('div');
              repoEl.className = 'timeline-repo';
              repoEl.style.borderLeftColor = repo.themeColor;
              
              const date = new Date(repo.created_at);
              const dateStr = date.toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'});
              
              repoEl.innerHTML = `
                <div class="timeline-dot" style="background:${repo.themeColor}"></div>
                <div class="timeline-repo-name" style="color:${repo.themeColor}">${repo.name}</div>
                <div class="timeline-repo-date">${dateStr}</div>
                <div style="font-size:12px;color:var(--muted);margin:8px 0">${repo.description || 'No description'}</div>
                <div class="timeline-repo-meta">
                  <span>${repo.language || '‚Äî'}</span>
                  <span>‚≠ê ${repo.stars}</span>
                  <span>${(repo.size_kb/1024).toFixed(1)}MB</span>
                </div>
              `;
              
              repoEl.addEventListener('click', () => showExpanded(repo, repo.theme));
              reposContainer.appendChild(repoEl);
            });
          
          monthSection.appendChild(reposContainer);
          yearSection.appendChild(monthSection);
        });
        
        container.appendChild(yearSection);
      });
    }

    function createCanvasRepos(){
      repos = [];
      const w = canvas.offsetWidth || window.innerWidth;
      const h = canvas.offsetHeight || window.innerHeight - 60;
      
      let number = 0;
      data.theme_rings.forEach((theme, themeIdx) => {
        const angle = (themeIdx / data.theme_rings.length) * Math.PI * 2;
        const distance = Math.min(w, h) * 0.32; // Even more spread
        const clusterX = w/2 + Math.cos(angle) * distance;
        const clusterY = h/2 + Math.sin(angle) * distance;
        
        theme.repos.forEach((repoData, repoIdx) => {
          number++;
          const baseSize = 16 + Math.random() * 12; // Bigger balls
          const localAngle = (repoIdx / theme.repos.length) * Math.PI * 2 * 2.2;
          const localDist = (repoIdx % 7) * 40 + Math.random() * 30; // Much better spacing
          const x = clusterX + Math.cos(localAngle) * localDist;
          const y = clusterY + Math.sin(localAngle) * localDist;
          
          repos.push(new Repo(repoData, x, y, baseSize, theme.color, number));
        });
      });
    }

    function animate(){
      if(currentView === 'ripple'){
        const w = canvas.offsetWidth;
        const h = canvas.offsetHeight;
        
        ctx.clearRect(0, 0, w, h);
        
        ripples = ripples.filter(r => {
          r.update();
          r.draw(ctx);
          return r.radius < r.maxRadius;
        });
        
        repos.forEach(repo => {
          repo.update();
          repo.draw(ctx);
        });
      }
      
      requestAnimationFrame(animate);
    }

    function showExpanded(repo, theme){
      document.getElementById('exp-title').textContent = repo.name;
      document.getElementById('exp-desc').textContent = repo.description || 'No description';
      
      // Stats
      document.getElementById('stats').innerHTML = `
        <div class="stat-card">
          <div class="stat-label">Stars</div>
          <div class="stat-value">${repo.stars}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Forks</div>
          <div class="stat-value">${repo.forks}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Size</div>
          <div class="stat-value">${(repo.size_kb/1024).toFixed(1)}MB</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Language</div>
          <div class="stat-value" style="font-size:14px">${repo.language || '‚Äî'}</div>
        </div>
      `;
      
      // Mock file ripples (in real scenario, would fetch from GitHub API)
      const files = ['README.md', 'index.html', 'style.css', 'script.js', 'package.json', 'LICENSE'];
      document.getElementById('file-list').innerHTML = files.map(f => 
        `<span class="file-ripple" style="border-color:${theme.color};color:${theme.color}">${f}</span>`
      ).join('');
      
      // Content area
      const content = document.getElementById('exp-content');
      if(repo.has_pages){
        content.innerHTML = `
          <iframe class="iframe-preview" src="https://hartswf0.github.io/${repo.name}/"></iframe>
          <div class="preview-actions">
            <a href="https://hartswf0.github.io/${repo.name}/" target="_blank" class="action-btn">Open Page</a>
            <a href="${repo.html_url}" target="_blank" class="action-btn secondary">View Code</a>
            ${repo.homepage ? `<a href="${repo.homepage}" target="_blank" class="action-btn secondary">Homepage</a>` : ''}
          </div>
        `;
      } else {
        content.innerHTML = `
          <div style="padding:40px;text-align:center;color:var(--muted)">
            <div style="font-size:48px;margin-bottom:20px">üì¶</div>
            <div style="margin-bottom:20px">This repository doesn't have GitHub Pages enabled</div>
            <div class="preview-actions" style="justify-content:center">
              <a href="${repo.html_url}" target="_blank" class="action-btn">View on GitHub</a>
              ${repo.homepage ? `<a href="${repo.homepage}" target="_blank" class="action-btn secondary">Homepage</a>` : ''}
            </div>
          </div>
        `;
      }
      
      document.getElementById('expanded').classList.add('open');
    }

    function setupEvents(){
      // Mobile menu toggle
      const hamburger = document.getElementById('hamburger');
      const mobileMenu = document.getElementById('mobile-menu');
      const menuOverlay = document.getElementById('menu-overlay');
      const menuClose = document.getElementById('menu-close');
      
      function openMenu(){
        hamburger.classList.add('active');
        mobileMenu.classList.add('open');
        menuOverlay.classList.add('open');
      }
      
      function closeMenu(){
        hamburger.classList.remove('active');
        mobileMenu.classList.remove('open');
        menuOverlay.classList.remove('open');
      }
      
      // Sync mobile menu state when opening
      function syncMobileMenu(){
        // Sync view buttons
        document.getElementById('mobile-view-grid').classList.toggle('active', currentView === 'grid');
        document.getElementById('mobile-view-ripple').classList.toggle('active', currentView === 'ripple');
        document.getElementById('mobile-view-timeline').classList.toggle('active', currentView === 'timeline');
        
        // Sync theme selection in theme list
        document.querySelectorAll('.theme-item').forEach(item => {
          item.classList.toggle('active', item.dataset.themeId === currentFilter.theme);
        });
        
        // Sync other filters
        document.getElementById('mobile-filter-lang').value = currentFilter.lang;
        document.getElementById('mobile-sort-by').value = currentFilter.sort;
      }
      
      hamburger.addEventListener('click', () => {
        syncMobileMenu();
        openMenu();
      });
      menuClose.addEventListener('click', closeMenu);
      menuOverlay.addEventListener('click', closeMenu);
      
      // Mobile view buttons
      document.getElementById('mobile-view-grid').addEventListener('click', () => {
        document.getElementById('view-grid').click();
        closeMenu();
      });
      
      document.getElementById('mobile-view-ripple').addEventListener('click', () => {
        document.getElementById('view-ripple').click();
        closeMenu();
      });
      
      document.getElementById('mobile-view-timeline').addEventListener('click', () => {
        document.getElementById('view-timeline').click();
        closeMenu();
      });
      
      // Mobile filters
      document.getElementById('mobile-filter-lang').addEventListener('change', (e) => {
        document.getElementById('filter-lang').value = e.target.value;
        currentFilter.lang = e.target.value;
        applyFiltersAndSort();
      });
      
      document.getElementById('mobile-sort-by').addEventListener('change', (e) => {
        document.getElementById('sort-by').value = e.target.value;
        currentFilter.sort = e.target.value;
        applyFiltersAndSort();
      });
      
      // Mobile zoom
      document.getElementById('mobile-zoom-in').addEventListener('click', () => {
        document.getElementById('zoom-in').click();
      });
      
      document.getElementById('mobile-zoom-out').addEventListener('click', () => {
        document.getElementById('zoom-out').click();
      });
      
      // Mobile connections
      document.getElementById('mobile-connections').addEventListener('click', () => {
        document.getElementById('show-connections').click();
        closeMenu();
      });
      
      // View toggle
      document.getElementById('view-grid').addEventListener('click', () => {
        currentView = 'grid';
        document.getElementById('grid-view').classList.add('active');
        document.getElementById('canvas-view').classList.remove('active');
        document.getElementById('timeline-view').classList.remove('active');
        document.getElementById('view-grid').classList.add('active');
        document.getElementById('view-ripple').classList.remove('active');
        document.getElementById('view-timeline').classList.remove('active');
      });

      document.getElementById('view-ripple').addEventListener('click', () => {
        currentView = 'ripple';
        document.getElementById('grid-view').classList.remove('active');
        document.getElementById('canvas-view').classList.add('active');
        document.getElementById('timeline-view').classList.remove('active');
        document.getElementById('view-grid').classList.remove('active');
        document.getElementById('view-ripple').classList.add('active');
        document.getElementById('view-timeline').classList.remove('active');
        resize();
      });

      document.getElementById('view-timeline').addEventListener('click', () => {
        currentView = 'timeline';
        document.getElementById('grid-view').classList.remove('active');
        document.getElementById('canvas-view').classList.remove('active');
        document.getElementById('timeline-view').classList.add('active');
        document.getElementById('view-grid').classList.remove('active');
        document.getElementById('view-ripple').classList.remove('active');
        document.getElementById('view-timeline').classList.add('active');
        createTimelineView();
      });

      // Filters
      document.getElementById('filter-theme').addEventListener('change', (e) => {
        currentFilter.theme = e.target.value;
        applyFiltersAndSort();
      });

      document.getElementById('filter-lang').addEventListener('change', (e) => {
        currentFilter.lang = e.target.value;
        applyFiltersAndSort();
      });

      document.getElementById('sort-by').addEventListener('change', (e) => {
        currentFilter.sort = e.target.value;
        applyFiltersAndSort();
      });

      // Zoom controls
      document.getElementById('zoom-in').addEventListener('click', () => {
        if(zoomLevel === 'sm') zoomLevel = 'md';
        else if(zoomLevel === 'md') zoomLevel = 'lg';
        else if(zoomLevel === 'lg') zoomLevel = 'xl';
        createGridView();
      });

      document.getElementById('zoom-out').addEventListener('click', () => {
        if(zoomLevel === 'xl') zoomLevel = 'lg';
        else if(zoomLevel === 'lg') zoomLevel = 'md';
        else if(zoomLevel === 'md') zoomLevel = 'sm';
        createGridView();
      });

      // Connections toggle
      document.getElementById('show-connections').addEventListener('click', (e) => {
        showConnections = !showConnections;
        e.target.classList.toggle('active');
        if(showConnections){
          drawConnections();
        } else {
          clearConnections();
        }
      });

      // Close expanded
      document.getElementById('close-expanded').addEventListener('click', () => {
        document.getElementById('expanded').classList.remove('open');
      });

      // Canvas events (ripple view)
      let isDragging = false;
      let dragStart = {x: 0, y: 0};

      canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        isDragging = true;
        dragStart = {x: e.clientX - rect.left, y: e.clientY - rect.top};
      });

      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        if(isDragging){
          const dx = x - dragStart.x;
          const dy = y - dragStart.y;
          repos.forEach(repo => {
            repo.targetX += dx;
            repo.targetY += dy;
          });
          dragStart = {x, y};
        } else {
          repos.forEach(repo => {
            repo.hovered = repo.contains(x, y);
          });
        }
      });

      canvas.addEventListener('mouseup', () => {
        isDragging = false;
      });

      canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        repos.forEach(repo => {
          if(repo.contains(x, y)){
            ripples.push(new Ripple(repo.x, repo.y, repo.color));
            // Find theme for this repo
            let theme = null;
            data.theme_rings.forEach(t => {
              if(t.repos.includes(repo.data)) theme = t;
            });
            showExpanded(repo.data, theme);
          }
        });
      });
    }

    function findRepoConnections(repo1, repo2){
      // Calculate connection strength based on multiple factors
      let strength = 0;
      let reasons = [];
      
      // 1. Same theme (strong connection)
      if(repo1.theme.theme_id === repo2.theme.theme_id){
        strength += 3;
        reasons.push('Same theme');
      }
      
      // 2. Shared topics
      const topics1 = new Set(repo1.topics || []);
      const topics2 = new Set(repo2.topics || []);
      const sharedTopics = [...topics1].filter(t => topics2.has(t));
      if(sharedTopics.length > 0){
        strength += sharedTopics.length * 2;
        reasons.push(`${sharedTopics.length} shared topic(s)`);
      }
      
      // 3. Similar name patterns (kebab case similarity)
      const name1Parts = repo1.name.toLowerCase().split(/[-_]/);
      const name2Parts = repo2.name.toLowerCase().split(/[-_]/);
      const sharedWords = name1Parts.filter(p => name2Parts.includes(p) && p.length > 3);
      if(sharedWords.length > 0){
        strength += sharedWords.length;
        reasons.push(`Similar names`);
      }
      
      // 4. Description keywords
      if(repo1.description && repo2.description){
        const desc1 = repo1.description.toLowerCase().split(/\s+/);
        const desc2 = repo2.description.toLowerCase().split(/\s+/);
        const keywords = ['ai', 'media', 'interactive', 'visualization', 'tool', 'framework', 'app', '3d', 'vr'];
        const shared = keywords.filter(k => 
          desc1.some(d => d.includes(k)) && desc2.some(d => d.includes(k))
        );
        if(shared.length > 0){
          strength += shared.length * 1.5;
          reasons.push(`Shared concepts`);
        }
      }
      
      // 5. Same language (weaker connection)
      if(repo1.language && repo1.language === repo2.language){
        strength += 1;
        reasons.push('Same language');
      }
      
      // 6. Similar size (might indicate similar complexity)
      const sizeDiff = Math.abs(repo1.size_kb - repo2.size_kb);
      const avgSize = (repo1.size_kb + repo2.size_kb) / 2;
      if(avgSize > 0 && sizeDiff / avgSize < 0.3){
        strength += 0.5;
      }
      
      return {strength, reasons};
    }

    function drawConnections(){
      // Create SVG overlay
      let svg = document.getElementById('connection-svg');
      if(!svg){
        svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.id = 'connection-svg';
        svg.style.position = 'absolute';
        svg.style.inset = '0';
        svg.style.pointerEvents = 'none';
        svg.style.zIndex = '1';
        document.getElementById('grid-view').appendChild(svg);
      }
      
      const grid = document.getElementById('grid-container');
      const rect = grid.getBoundingClientRect();
      svg.setAttribute('width', rect.width);
      svg.setAttribute('height', rect.height);
      svg.innerHTML = '';
      
      // Get positions
      const oranges = grid.querySelectorAll('.orange');
      const repoPositions = Array.from(oranges).map((el, idx) => {
        const r = el.getBoundingClientRect();
        return {
          x: r.left + r.width/2 - rect.left,
          y: r.top + r.height/2 - rect.top,
          repo: filteredRepos[idx]
        };
      });
      
      // Find and draw meaningful connections
      let connectionsDrawn = 0;
      const maxConnections = 100; // Limit to prevent clutter
      
      repoPositions.forEach((pos1, i) => {
        repoPositions.slice(i+1).forEach((pos2) => {
          if(connectionsDrawn >= maxConnections) return;
          
          const connection = findRepoConnections(pos1.repo, pos2.repo);
          
          // Only draw if strength is above threshold
          if(connection.strength >= 3){
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', pos1.x);
            line.setAttribute('y1', pos1.y);
            line.setAttribute('x2', pos2.x);
            line.setAttribute('y2', pos2.y);
            
            // Visual encoding of connection strength
            const opacity = Math.min(connection.strength / 10, 0.6);
            const width = Math.min(connection.strength / 2, 3);
            
            line.setAttribute('stroke', pos1.repo.themeColor);
            line.setAttribute('stroke-width', width);
            line.setAttribute('stroke-opacity', opacity);
            line.setAttribute('stroke-dasharray', connection.strength > 5 ? '0' : '4,4');
            
            // Add tooltip
            const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
            title.textContent = `${pos1.repo.name} ‚Üî ${pos2.repo.name}\n${connection.reasons.join(', ')}`;
            line.appendChild(title);
            
            svg.appendChild(line);
            connectionsDrawn++;
          }
        });
      });
      
      // Show connection count
      console.log(`üìä Drew ${connectionsDrawn} meaningful connections`);
    }

    function clearConnections(){
      const svg = document.getElementById('connection-svg');
      if(svg) svg.remove();
    }

    init();
  </script>
</body>
</html>
